name: Build and Upload Conda Packages + Conda-Forge Automation

on:
  release:
    types: [published]
  workflow_dispatch:
    inputs:
      version:
        description: 'Package version to build (e.g., 2.1.2)'
        required: true
        type: string

jobs:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # JOB 1: Wait for PyPI and get SHA256 from PyPI directly
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  wait-for-pypi:
    runs-on: ubuntu-latest
    timeout-minutes: 1440  # 24 hours - no rush, let builds complete
    outputs:
      version: ${{ steps.get-version.outputs.version }}
      sha256: ${{ steps.get-sha.outputs.sha256 }}
    steps:
    - name: Get version from release or input
      id: get-version
      run: |
        if [ "${{ github.event_name }}" == "release" ]; then
          VERSION="${{ github.event.release.tag_name }}"
          VERSION="${VERSION#v}"  # Remove 'v' prefix if present
        else
          VERSION="${{ github.event.inputs.version }}"
        fi
        echo "version=$VERSION" >> $GITHUB_OUTPUT
        echo "ğŸ” Target version: $VERSION"
      
    - name: Wait for PyPI and extract SHA256
      id: get-sha
      run: |
        VERSION="${{ steps.get-version.outputs.version }}"
        
        echo "â³ Waiting for omnipkg $VERSION on PyPI..."
        echo "â° No timeout - will wait as long as needed for your builds to complete"
        
        ATTEMPT=0
        while true; do
          ATTEMPT=$((ATTEMPT + 1))
          ELAPSED=$((ATTEMPT * 2))
          
          if [ $((ATTEMPT % 30)) -eq 0 ]; then
            echo "ğŸ• Still waiting... ${ELAPSED} minutes elapsed"
          fi
          
          # Check PyPI JSON API for the version
          HTTP_CODE=$(curl -s -o pypi_response.json -w "%{http_code}" \
            "https://pypi.org/pypi/omnipkg/$VERSION/json")
          
          if [ "$HTTP_CODE" = "200" ]; then
            echo "âœ… Package found on PyPI!"
            
            # Extract SHA256 directly from PyPI JSON for the .tar.gz file
            SHA256=$(jq -r '.urls[] | select(.filename | endswith(".tar.gz")) | .digests.sha256' pypi_response.json)
            
            if [ -n "$SHA256" ] && [ "$SHA256" != "null" ]; then
              echo "âœ… SHA256 extracted from PyPI: $SHA256"
              echo "sha256=$SHA256" >> $GITHUB_OUTPUT
              
              # Verify the file is actually downloadable
              DOWNLOAD_URL="https://files.pythonhosted.org/packages/source/o/omnipkg/omnipkg-$VERSION.tar.gz"
              DOWNLOAD_CODE=$(curl -s -o /dev/null -w "%{http_code}" -I "$DOWNLOAD_URL")
              
              if [ "$DOWNLOAD_CODE" = "200" ] || [ "$DOWNLOAD_CODE" = "302" ]; then
                echo "âœ… Package file is downloadable!"
                break
              else
                echo "âš ï¸  Package found but file not yet on CDN (HTTP $DOWNLOAD_CODE), retrying..."
              fi
            else
              echo "âš ï¸  SHA256 not found in response, retrying..."
            fi
          fi
          
          sleep 120  # Check every 2 minutes
        done
        
        rm -f pypi_response.json

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # JOB 2: Update local meta.yaml templates in main repo
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  update-local-metas:
    needs: wait-for-pypi
    runs-on: ubuntu-latest
    steps:
    - name: Checkout omnipkg repo
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: Update meta-noarch.yaml
      run: |
        VERSION="${{ needs.wait-for-pypi.outputs.version }}"
        SHA256="${{ needs.wait-for-pypi.outputs.sha256 }}"
        
        echo "ğŸ“ Updating src/omnipkg/conda-recipes/meta-noarch.yaml"
        sed -i "s/{% set version = \".*\" %}/{% set version = \"$VERSION\" %}/" src/omnipkg/conda-recipes/meta-noarch.yaml
        sed -i "s/sha256: .*/sha256: $SHA256/" src/omnipkg/conda-recipes/meta-noarch.yaml
        
        echo "âœ… Updated meta-noarch.yaml"
        
    - name: Update meta-platforms.yaml
      run: |
        VERSION="${{ needs.wait-for-pypi.outputs.version }}"
        SHA256="${{ needs.wait-for-pypi.outputs.sha256 }}"
        
        echo "ğŸ“ Updating src/omnipkg/conda-recipes/meta-platforms.yaml"
        sed -i "s/{% set version = \".*\" %}/{% set version = \"$VERSION\" %}/" src/omnipkg/conda-recipes/meta-platforms.yaml
        sed -i "s/sha256: .*/sha256: $SHA256/" src/omnipkg/conda-recipes/meta-platforms.yaml
        
        echo "âœ… Updated meta-platforms.yaml"
        
    - name: Commit and push updates
      run: |
        VERSION="${{ needs.wait-for-pypi.outputs.version }}"
        
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add src/omnipkg/conda-recipes/meta-noarch.yaml src/omnipkg/conda-recipes/meta-platforms.yaml
        
        if git diff --staged --quiet; then
          echo "â„¹ï¸  No changes to commit"
        else
          git commit -m "chore: update conda meta files to version $VERSION"
          git push
          echo "âœ… Changes pushed to main repo"
        fi

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # JOB 3: Update conda-forge feedstock (NOARCH - Build 0)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  update-feedstock-noarch:
    name: "ğŸš€ Conda-Forge Noarch (Build 0)"
    needs: [wait-for-pypi, update-local-metas]
    runs-on: ubuntu-latest
    timeout-minutes: 120
    outputs:
      pr_number: ${{ steps.create-pr.outputs.pull-request-number }}
    steps:
    - name: Checkout feedstock fork
      uses: actions/checkout@v4
      with:
        repository: 1minds3t/omnipkg-feedstock
        token: ${{ secrets.FEEDSTOCK_TOKEN }}
        path: feedstock
        fetch-depth: 0

    - name: Sync fork with upstream
      run: |
        cd feedstock
        git remote add upstream https://github.com/conda-forge/omnipkg-feedstock.git
        git fetch upstream
        git checkout main
        git merge upstream/main --no-edit || echo "Already up to date"
        git push origin main
        echo "âœ… Fork synced with conda-forge/omnipkg-feedstock"

    - name: Checkout main repo for template
      uses: actions/checkout@v4
      with:
        path: main-repo

    - name: Update feedstock recipe/meta.yaml (NOARCH)
      run: |
        cd feedstock
        VERSION="${{ needs.wait-for-pypi.outputs.version }}"
        SHA256="${{ needs.wait-for-pypi.outputs.sha256 }}"
        
        echo "ğŸ“ Updating recipe/meta.yaml for NOARCH (build 0)"
        
        # Copy the noarch template from main repo
        cp ../main-repo/src/omnipkg/conda-recipes/meta-noarch.yaml recipe/meta.yaml
        
        # Ensure version and SHA256 are set correctly
        sed -i "s/{% set version = \".*\" %}/{% set version = \"$VERSION\" %}/" recipe/meta.yaml
        sed -i "s/sha256: .*/sha256: $SHA256/" recipe/meta.yaml
        
        echo "âœ… Updated recipe/meta.yaml for NOARCH:"
        head -50 recipe/meta.yaml
        
    - name: Create branch and commit
      run: |
        cd feedstock
        VERSION="${{ needs.wait-for-pypi.outputs.version }}"
        BRANCH="update-noarch-v$VERSION"
        
        git checkout -b "$BRANCH"
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add recipe/meta.yaml
        
        if git diff --staged --quiet; then
          echo "â„¹ï¸  No changes to commit"
          echo "skip_pr=true" >> $GITHUB_ENV
        else
          git commit -m "Update omnipkg to $VERSION (noarch)"
          git push -f origin "$BRANCH"
          echo "âœ… Changes pushed to branch $BRANCH"
          echo "skip_pr=false" >> $GITHUB_ENV
        fi
        
    - name: Create PR to conda-forge
      id: create-pr
      if: env.skip_pr != 'true'
      env:
        GH_TOKEN: ${{ secrets.FEEDSTOCK_TOKEN }}
      run: |
        cd feedstock
        VERSION="${{ needs.wait-for-pypi.outputs.version }}"
        BRANCH="update-noarch-v$VERSION"
        
        # Create PR
        PR_URL=$(gh pr create \
          --repo conda-forge/omnipkg-feedstock \
          --base main \
          --head 1minds3t:$BRANCH \
          --title "Update omnipkg to $VERSION (noarch)" \
          --body "ğŸ¤– Automated update to omnipkg version $VERSION (noarch build)

**Changes:**
- âœ… Version: $VERSION
- âœ… SHA256: ${{ needs.wait-for-pypi.outputs.sha256 }}
- âœ… Build number: 0
- âœ… Architecture: noarch

This PR updates the recipe for conda-forge distribution." || echo "")
        
        if [ -n "$PR_URL" ]; then
          PR_NUMBER=$(echo "$PR_URL" | grep -oP '\d+$')
          echo "âœ… PR created: $PR_URL"
          echo "pull-request-number=$PR_NUMBER" >> $GITHUB_OUTPUT
        else
          echo "âš ï¸  PR may already exist, checking..."
          PR_NUMBER=$(gh pr list --repo conda-forge/omnipkg-feedstock --head 1minds3t:$BRANCH --json number --jq '.[0].number')
          echo "pull-request-number=$PR_NUMBER" >> $GITHUB_OUTPUT
        fi

    - name: Request re-render
      if: env.skip_pr != 'true' && steps.create-pr.outputs.pull-request-number != ''
      env:
        GH_TOKEN: ${{ secrets.FEEDSTOCK_TOKEN }}
      run: |
        cd feedstock
        PR_NUMBER="${{ steps.create-pr.outputs.pull-request-number }}"
        
        echo "ğŸ”„ Requesting re-render from @conda-forge-admin..."
        gh pr comment $PR_NUMBER \
          --repo conda-forge/omnipkg-feedstock \
          --body "@conda-forge-admin, please rerender"
        
        echo "âœ… Re-render requested, waiting 10 minutes for conda-forge-admin..."
        sleep 600  # Wait 10 minutes for re-render

    - name: Wait for checks to pass
      if: env.skip_pr != 'true' && steps.create-pr.outputs.pull-request-number != ''
      env:
        GH_TOKEN: ${{ secrets.FEEDSTOCK_TOKEN }}
      run: |
        PR_NUMBER="${{ steps.create-pr.outputs.pull-request-number }}"
        
        echo "â³ Waiting for CI checks to complete..."
        echo "â° Waiting additional 5 minutes for re-render to adjust builds..."
        sleep 300
        
        # Now wait for actual checks to pass
        ATTEMPT=0
        MAX_ATTEMPTS=60  # 2 hours max
        
        while [ $ATTEMPT -lt $MAX_ATTEMPTS ]; do
          ATTEMPT=$((ATTEMPT + 1))
          
          # Get check status
          STATUS=$(gh pr view $PR_NUMBER \
            --repo conda-forge/omnipkg-feedstock \
            --json statusCheckRollup \
            --jq '.statusCheckRollup[] | select(.conclusion != null) | .conclusion' | sort -u)
          
          PENDING=$(gh pr view $PR_NUMBER \
            --repo conda-forge/omnipkg-feedstock \
            --json statusCheckRollup \
            --jq '.statusCheckRollup[] | select(.status == "IN_PROGRESS" or .status == "PENDING") | .name' | wc -l)
          
          TOTAL=$(gh pr view $PR_NUMBER \
            --repo conda-forge/omnipkg-feedstock \
            --json statusCheckRollup \
            --jq '.statusCheckRollup | length')
          
          echo "ğŸ“Š Check status (Attempt $ATTEMPT): $((TOTAL - PENDING))/$TOTAL completed"
          
          if [ "$PENDING" -eq 0 ] && [ "$TOTAL" -gt 0 ]; then
            if echo "$STATUS" | grep -q "FAILURE"; then
              echo "âŒ Some checks failed"
              gh pr view $PR_NUMBER --repo conda-forge/omnipkg-feedstock --json statusCheckRollup
              exit 1
            elif echo "$STATUS" | grep -q "SUCCESS"; then
              echo "âœ… All checks passed!"
              break
            fi
          fi
          
          sleep 120  # Check every 2 minutes
        done

    - name: Merge PR
      if: env.skip_pr != 'true' && steps.create-pr.outputs.pull-request-number != ''
      env:
        GH_TOKEN: ${{ secrets.FEEDSTOCK_TOKEN }}
      run: |
        PR_NUMBER="${{ steps.create-pr.outputs.pull-request-number }}"
        VERSION="${{ needs.wait-for-pypi.outputs.version }}"
        
        echo "ğŸ¯ Merging PR #$PR_NUMBER..."
        gh pr merge $PR_NUMBER \
          --repo conda-forge/omnipkg-feedstock \
          --squash \
          --subject "Build for $VERSION (noarch)" \
          --body ""
        
        echo "âœ… Noarch build merged to conda-forge!"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # JOB 4: Update conda-forge feedstock (PLATFORMS - Build 1)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  update-feedstock-platforms:
    name: "ğŸš€ Conda-Forge Platforms (Build 1)"
    needs: [wait-for-pypi, update-feedstock-noarch]
    runs-on: ubuntu-latest
    timeout-minutes: 180
    steps:
    - name: Checkout feedstock fork
      uses: actions/checkout@v4
      with:
        repository: 1minds3t/omnipkg-feedstock
        token: ${{ secrets.FEEDSTOCK_TOKEN }}
        path: feedstock
        fetch-depth: 0

    - name: Sync fork with upstream again
      run: |
        cd feedstock
        git remote add upstream https://github.com/conda-forge/omnipkg-feedstock.git || true
        git fetch upstream
        git checkout main
        git merge upstream/main --no-edit || echo "Already up to date"
        git push origin main
        echo "âœ… Fork re-synced after noarch merge"

    - name: Checkout main repo for template
      uses: actions/checkout@v4
      with:
        path: main-repo

    - name: Update feedstock recipe/meta.yaml (PLATFORMS)
      run: |
        cd feedstock
        VERSION="${{ needs.wait-for-pypi.outputs.version }}"
        SHA256="${{ needs.wait-for-pypi.outputs.sha256 }}"
        
        echo "ğŸ“ Updating recipe/meta.yaml for PLATFORMS (build 1)"
        
        # Copy the platforms template from main repo
        cp ../main-repo/src/omnipkg/conda-recipes/meta-platforms.yaml recipe/meta.yaml
        
        # Ensure version and SHA256 are set correctly
        sed -i "s/{% set version = \".*\" %}/{% set version = \"$VERSION\" %}/" recipe/meta.yaml
        sed -i "s/sha256: .*/sha256: $SHA256/" recipe/meta.yaml
        
        echo "âœ… Updated recipe/meta.yaml for PLATFORMS:"
        head -50 recipe/meta.yaml
        
    - name: Create branch and commit
      run: |
        cd feedstock
        VERSION="${{ needs.wait-for-pypi.outputs.version }}"
        BRANCH="update-platforms-v$VERSION"
        
        git checkout -b "$BRANCH"
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add recipe/meta.yaml
        
        if git diff --staged --quiet; then
          echo "â„¹ï¸  No changes to commit"
          echo "skip_pr=true" >> $GITHUB_ENV
        else
          git commit -m "Update omnipkg to $VERSION (platforms)"
          git push -f origin "$BRANCH"
          echo "âœ… Changes pushed to branch $BRANCH"
          echo "skip_pr=false" >> $GITHUB_ENV
        fi
        
    - name: Create PR to conda-forge
      id: create-pr
      if: env.skip_pr != 'true'
      env:
        GH_TOKEN: ${{ secrets.FEEDSTOCK_TOKEN }}
      run: |
        cd feedstock
        VERSION="${{ needs.wait-for-pypi.outputs.version }}"
        BRANCH="update-platforms-v$VERSION"
        
        # Create PR
        PR_URL=$(gh pr create \
          --repo conda-forge/omnipkg-feedstock \
          --base main \
          --head 1minds3t:$BRANCH \
          --title "Update omnipkg to $VERSION (platforms)" \
          --body "ğŸ¤– Automated update to omnipkg version $VERSION (platform builds)

**Changes:**
- âœ… Version: $VERSION
- âœ… SHA256: ${{ needs.wait-for-pypi.outputs.sha256 }}
- âœ… Build number: 1
- âœ… Architectures: linux-64, linux-aarch64, linux-ppc64le, osx-64, osx-arm64, win-64

This PR updates the recipe for conda-forge distribution with platform-specific builds." || echo "")
        
        if [ -n "$PR_URL" ]; then
          PR_NUMBER=$(echo "$PR_URL" | grep -oP '\d+$')
          echo "âœ… PR created: $PR_URL"
          echo "pull-request-number=$PR_NUMBER" >> $GITHUB_OUTPUT
        else
          echo "âš ï¸  PR may already exist, checking..."
          PR_NUMBER=$(gh pr list --repo conda-forge/omnipkg-feedstock --head 1minds3t:$BRANCH --json number --jq '.[0].number')
          echo "pull-request-number=$PR_NUMBER" >> $GITHUB_OUTPUT
        fi

    - name: Request re-render
      if: env.skip_pr != 'true' && steps.create-pr.outputs.pull-request-number != ''
      env:
        GH_TOKEN: ${{ secrets.FEEDSTOCK_TOKEN }}
      run: |
        cd feedstock
        PR_NUMBER="${{ steps.create-pr.outputs.pull-request-number }}"
        
        echo "ğŸ”„ Requesting re-render from @conda-forge-admin..."
        gh pr comment $PR_NUMBER \
          --repo conda-forge/omnipkg-feedstock \
          --body "@conda-forge-admin, please rerender"
        
        echo "âœ… Re-render requested, waiting 10 minutes for conda-forge-admin..."
        sleep 600  # Wait 10 minutes for re-render

    - name: Wait for checks to pass
      if: env.skip_pr != 'true' && steps.create-pr.outputs.pull-request-number != ''
      env:
        GH_TOKEN: ${{ secrets.FEEDSTOCK_TOKEN }}
      run: |
        PR_NUMBER="${{ steps.create-pr.outputs.pull-request-number }}"
        
        echo "â³ Waiting for CI checks to complete (platforms take ~30 min)..."
        echo "â° Waiting additional 5 minutes for re-render to adjust builds..."
        sleep 300
        
        # Now wait for actual checks to pass (this will take longer - 10+ checks)
        ATTEMPT=0
        MAX_ATTEMPTS=90  # 3 hours max for platform builds
        
        while [ $ATTEMPT -lt $MAX_ATTEMPTS ]; do
          ATTEMPT=$((ATTEMPT + 1))
          
          # Get check status
          STATUS=$(gh pr view $PR_NUMBER \
            --repo conda-forge/omnipkg-feedstock \
            --json statusCheckRollup \
            --jq '.statusCheckRollup[] | select(.conclusion != null) | .conclusion' | sort -u)
          
          PENDING=$(gh pr view $PR_NUMBER \
            --repo conda-forge/omnipkg-feedstock \
            --json statusCheckRollup \
            --jq '.statusCheckRollup[] | select(.status == "IN_PROGRESS" or .status == "PENDING") | .name' | wc -l)
          
          TOTAL=$(gh pr view $PR_NUMBER \
            --repo conda-forge/omnipkg-feedstock \
            --json statusCheckRollup \
            --jq '.statusCheckRollup | length')
          
          echo "ğŸ“Š Check status (Attempt $ATTEMPT): $((TOTAL - PENDING))/$TOTAL completed"
          
          if [ "$PENDING" -eq 0 ] && [ "$TOTAL" -gt 10 ]; then
            if echo "$STATUS" | grep -q "FAILURE"; then
              echo "âŒ Some checks failed"
              gh pr view $PR_NUMBER --repo conda-forge/omnipkg-feedstock --json statusCheckRollup
              exit 1
            elif echo "$STATUS" | grep -q "SUCCESS"; then
              echo "âœ… All platform checks passed!"
              break
            fi
          fi
          
          sleep 120  # Check every 2 minutes
        done

    - name: Merge PR
      if: env.skip_pr != 'true' && steps.create-pr.outputs.pull-request-number != ''
      env:
        GH_TOKEN: ${{ secrets.FEEDSTOCK_TOKEN }}
      run: |
        PR_NUMBER="${{ steps.create-pr.outputs.pull-request-number }}"
        VERSION="${{ needs.wait-for-pypi.outputs.version }}"
        
        echo "ğŸ¯ Merging PR #$PR_NUMBER..."
        gh pr merge $PR_NUMBER \
          --repo conda-forge/omnipkg-feedstock \
          --squash \
          --subject "Build for $VERSION (platforms)" \
          --body ""
        
        echo "âœ… Platform builds merged to conda-forge!"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # JOB 5: Final Summary
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  final-summary:
    name: "ğŸ“Š Release Summary"
    needs: [wait-for-pypi, update-local-metas, update-feedstock-noarch, update-feedstock-platforms]
    runs-on: ubuntu-latest
    if: always()
    steps:
    - name: Print Summary
      run: |
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ‰ CONDA-FORGE RELEASE COMPLETE"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        echo "Version: ${{ needs.wait-for-pypi.outputs.version }}"
        echo "SHA256: ${{ needs.wait-for-pypi.outputs.sha256 }}"
        echo ""
        echo "âœ… PyPI sync: ${{ needs.wait-for-pypi.result }}"
        echo "âœ… Local meta updates: ${{ needs.update-local-metas.result }}"
        echo "âœ… Conda-forge noarch: ${{ needs.update-feedstock-noarch.result }}"
        echo "âœ… Conda-forge platforms: ${{ needs.update-feedstock-platforms.result }}"
        echo ""
        echo "ğŸ¯ Package now available on conda-forge!"
        echo "Install with: conda install -c conda-forge omnipkg"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
